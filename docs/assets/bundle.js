l(de.current),d(Mn),Gt>Mn&&Zt-se.current>H)if(se.current=Zt,h(St=>St+1),C(Gt),z.current===null)z.current=Zt,y(Zt),fe({type:"tip",time:Zt,max:Gt,thresh:Mn,floor:de.current});else{const St=Zt-z.current;if(v(Zt),b(St),St>=L&&St<=Y){fe({type:"rack",time:Zt,max:Gt,thresh:Mn,floor:de.current,deltaT:St});const Dn=j*Pje/St*2.23693629;A(Dn),z.current=null}else fe({type:"rejected",time:Zt,max:Gt,thresh:Mn,floor:de.current,deltaT:St,reason:St<L?"too fast":"too slow"}),St>Y&&(z.current=Zt,y(Zt))}requestAnimationFrame(Wr)};requestAnimationFrame(Wr)}catch(re){console.error(re),i(`ERROR: ${re.message}`),n(!1)}},Ke=()=>{oe.current=!1,Pe.current&&Pe.current.getTracks().forEach(re=>re.stop()),pe.current&&pe.current.close(),n(!1),i("Stopped")},Ye=()=>{T([]),h(0),y(null),v(null),b(null),A(null),C(null)},lt=()=>{const re={exportedAt:new Date().toISOString(),config:{distanceIn:j,minThresh:O,floorMult:F,refractTime:H,minDeltaT:L,maxDeltaT:Y,hpfFreq:xe,lpfFreq:Fe},peaks:_},He=new Blob([JSON.stringify(re,null,2)],{type:"application/json"}),Ht=URL.createObjectURL(He),wt=document.createElement("a");wt.href=Ht,wt.download=`break-debug-${Date.now()}.json`,wt.click(),URL.revokeObjectURL(Ht)};S.useEffect(()=>()=>{oe.current=!1,Pe.current&&Pe.current.getTracks().forEach(re=>re.stop()),pe.current&&pe.current.close()},[]);const Ue=re=>{switch(re){case"tip":return"text-yellow-500";case"rack":return"text-primary font-bold";case"rejected":return"text-muted-foreground";case"debug":return"text-blue-400";default:return"text-muted-foreground"}};return u.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[u.jsxs("header",{className:"flex items-center gap-4 p-4 border-b",children:[u.jsx(ae,{variant:"ghost",size:"icon",onClick:()=>t("/"),"data-testid":"button-back",children:u.jsx(Io,{className:"w-5 h-5"})}),u.jsxs("div",{children:[u.jsx("h1",{className:"text-xl font-bold text-primary",children:"Audio Debugger"}),u.jsx("p",{className:"text-sm text-muted-foreground",children:"Break speed detection diagnostics"})]})]}),u.jsx("main",{className:"flex-1 p-4 overflow-auto",children:u.jsxs("div",{className:"max-w-2xl mx-auto space-y-4",children:[u.jsxs("div",{className:"flex gap-2 flex-wrap",children:[u.jsxs(ae,{onClick:e?Ke:be,variant:e?"destructive":"default","data-testid":"button-toggle-listen",children:[e?u.jsx(uH,{className:"w-4 h-4 mr-2"}):u.jsx(dH,{className:"w-4 h-4 mr-2"}),e?"Stop":"Start Listening"]}),u.jsxs(ae,{variant:"secondary",onClick:Ye,"data-testid":"button-clear",children:[u.jsx(Sy,{className:"w-4 h-4 mr-2"}),"Clear"]}),u.jsxs(ae,{variant:"secondary",onClick:lt,"data-testid":"button-export",children:[u.jsx(Y$,{className:"w-4 h-4 mr-2"}),"Export"]})]}),u.jsxs(tt,{className:"p-4 bg-muted/30",children:[u.jsxs("p",{className:"text-sm font-mono","data-testid":"text-mic-status",children:[u.jsx("span",{className:"text-muted-foreground",children:"Status:"})," ",u.jsx("span",{className:e?"text-green-500":"text-muted-foreground",children:r})]}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Frame: ",N]})]}),E!==null&&u.jsxs(tt,{className:"p-6 bg-gradient-to-br from-primary/20 to-primary/5 border-primary/30 text-center",children:[u.jsx("p",{className:"text-sm text-primary uppercase tracking-wide",children:"Break Detected"}),u.jsxs("p",{className:"text-4xl font-bold","data-testid":"text-result-mph",children:[E.toFixed(1)," mph"]}),u.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Delta: ",x==null?void 0:x.toFixed(4),"s | Distance: ",j,'"']})]}),u.jsxs(tt,{className:"p-4",children:[u.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground mb-3",children:"Audio Levels"}),u.jsxs("div",{className:"space-y-3",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("span",{className:"text-xs w-16",children:"Current"}),u.jsxs("div",{className:"flex-1 h-6 bg-muted rounded overflow-hidden relative",children:[u.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 via-yellow-500 to-red-500 transition-all",style:{width:`${Math.min(o*100,100)}%`}}),u.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-white",style:{left:`${c*100}%`}})]}),u.jsx("span",{className:"text-xs font-mono w-14 text-right",children:o.toFixed(3)})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("span",{className:"text-xs w-16",children:"Floor"}),u.jsx("div",{className:"flex-1 h-4 bg-muted rounded overflow-hidden",children:u.jsx("div",{className:"h-full bg-blue-500 transition-all",style:{width:`${a*100}%`}})}),u.jsx("span",{className:"text-xs font-mono w-14 text-right",children:a.toFixed(3)})]}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("span",{className:"text-xs w-16",children:"Thresh"}),u.jsx("div",{className:"flex-1 h-4 bg-muted rounded overflow-hidden",children:u.jsx("div",{className:"h-full bg-yellow-500 transition-all",style:{width:`${c*100}%`}})}),u.jsx("span",{className:"text-xs font-mono w-14 text-right",children:c.toFixed(3)})]})]})]}),u.jsxs(tt,{className:"p-4",children:[u.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground mb-3",children:"Detection Stats"}),u.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[u.jsxs("div",{className:"bg-muted/50 p-2 rounded",children:[u.jsx("p",{className:"text-lg font-bold text-primary",children:f}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Peaks"})]}),u.jsxs("div",{className:"bg-muted/50 p-2 rounded",children:[u.jsx("p",{className:"text-lg font-bold font-mono",children:(m==null?void 0:m.toFixed(3))??"-"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Tip Time"})]}),u.jsxs("div",{className:"bg-muted/50 p-2 rounded",children:[u.jsx("p",{className:"text-lg font-bold font-mono",children:(x==null?void 0:x.toFixed(4))??"-"}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Delta T"})]})]}),u.jsxs("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:["Last peak max: ",(w==null?void 0:w.toFixed(4))??"-"]})]}),u.jsxs(tt,{className:"p-4",children:[u.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground mb-3",children:"Configuration"}),u.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"Distance (in)"}),u.jsx(fr,{type:"number",value:j,onChange:re=>R(+re.target.value),className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"Min Threshold"}),u.jsx(fr,{type:"number",value:O,onChange:re=>$(+re.target.value),step:"0.01",className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"Floor Multiplier"}),u.jsx(fr,{type:"number",value:F,onChange:re=>U(+re.target.value),step:"0.1",className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"Refractory (s)"}),u.jsx(fr,{type:"number",value:H,onChange:re=>V(+re.target.value),step:"0.01",className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"Min Delta T (s)"}),u.jsx(fr,{type:"number",value:L,onChange:re=>X(+re.target.value),step:"0.005",className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"Max Delta T (s)"}),u.jsx(fr,{type:"number",value:Y,onChange:re=>te(+re.target.value),step:"0.01",className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"HPF Freq (Hz)"}),u.jsx(fr,{type:"number",value:xe,onChange:re=>Ae(+re.target.value),step:"50",className:"h-8"})]}),u.jsxs("div",{children:[u.jsx(cn,{className:"text-xs",children:"LPF Freq (Hz)"}),u.jsx(fr,{type:"number",value:Fe,onChange:re=>Xe(+re.target.value),step:"100",className:"h-8"})]})]})]}),u.jsxs(tt,{className:"p-4",children:[u.jsx("h3",{className:"text-sm font-semibold uppercase text-muted-foreground mb-3",children:"Peak Log"}),u.jsx("div",{className:"max-h-48 overflow-y-auto bg-background rounded p-2 font-mono text-xs space-y-1",children:_.length===0?u.jsx("p",{className:"text-muted-foreground text-center py-4",children:"No peaks detected yet"}):_.map((re,He)=>u.jsxs("div",{className:`flex justify-between ${Ue(re.type)}`,children:[u.jsxs("span",{children:[re.type.toUpperCase()," @ ",re.time.toFixed(4),"s"]}),u.jsxs("span",{children:["max: ",re.max.toFixed(4)," ",re.deltaT?`dt: ${re.deltaT.toFixed(4)}`:""," ",re.reason||""]})]},He))})]})]})})]})}function jje(){return u.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gray-50",children:u.jsx(tt,{className:"w-full max-w-md mx-4",children:u.jsxs(c5,{className:"pt-6",children:[u.jsxs("div",{className:"flex mb-4 gap-2",children:[u.jsx(ZW,{className:"h-8 w-8 text-red-500"}),u.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"404 Page Not Found"})]}),u.jsx("p",{className:"mt-4 text-sm text-gray-600",children:"Did you forget to add the page to the router?"})]})})})}const Ije=typeof window<"u"&&(window.location.protocol==="file:"||window.location.pathname.endsWith(".html")||window.location.hostname.endsWith(".github.io")),kje=t=>{window.location.hash=t},Oje=t=>(window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)),Rje=()=>window.location.hash.replace(/^#/,"")||"/";function Mje(){const t=S.useSyncExternalStore(Oje,Rje,()=>"/"),e=S.useCallback(n=>kje(n),[]);return[t,e]}function Dje(){return u.jsx(u$,{hook:Ije?Mje:void 0,children:u.jsxs(T7,{children:[u.jsx(Cs,{path:"/",component:Nre}),u.jsx(Cs,{path:"/break-speed",component:nie}),u.jsx(Cs,{path:"/shot-clock",component:JNe}),u.jsx(Cs,{path:"/table-level",component:eje}),u.jsx(Cs,{path:"/cue-emulator",component:_je}),u.jsx(Cs,{path:"/insights",component:Eje}),u.jsx(Cs,{path:"/admin/analytics",component:Tje}),u.jsx(Cs,{path:"/debug/audio",component:Nje}),u.jsx(Cs,{component:jje})]})})}function $je(){return u.jsx(Y7,{client:J7,children:u.jsx(jG,{children:u.jsx(Kee,{children:u.jsxs(AG,{children:[u.jsx(nq,{}),u.jsx(Dje,{})]})})})})}ZD(document.getElementById("root")).render(u.jsx($je,{}));
